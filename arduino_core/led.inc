.ifndef ATMEGA328P_CONSTANTS
.include "atmega328p_core/const_codes.inc"
.endif

.text
.equ PORTB_PIN13, 0x20	; is also SCK ((Serial Clock) - The clock pulses which synchronize data transmission generated by the master) bit changing this bit will generate TWI interrupt (perhaps other interrupts also)

flash_led:	
	push r16			; save r16 to stack
	push r17			; save r17
	in r16, PINB		; get values from PORTB
	ldi r17, PORTB_PIN13
	eor r16, r17		; exclusive or of PINB value
	out PORTB, r16		; set r16 value to PORTB
	pop r17				; restore r17
	pop r16				; restore r16 from stack
	ret
	
; sets arduino led on
; function does not take nor return parameters
set_led:
	push r16			; save r16 to stack
	in r16, PINB		; get values from PORTB
	sbr r16, PORTB_PIN13; set fifth bit
	out PORTB, r16		; set r16 value to PORTB
	pop r16				; restore r16 from stack
	ret
	
; clear arduino led bit
unset_led:
	push r16			; save r16 to stack
	in r16, PINB		; get values from PORTB
	cbr r16, PORTB_PIN13; clear fifth bit
	out PORTB, r16		; set r16 value to PORTB
	pop r16				; restore r16 from stack
	ret
	
init_led:
	push r16
	; set 5th bit (13th pin) for output, thers for input
	; NOTE should set input pins with 0 directly
	ldi r16, PORTB_PIN13	
	out DDRB, r16
	pop r16
	ret
	